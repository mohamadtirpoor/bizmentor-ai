# ุฑุงูููุง ููุงุฌุฑุช ู ูุฏุฑุช ุฏุชุงุจุณ

## โ๏ธ ูุดุฏุงุฑ ููู

**ูุฑฺฏุฒ ุงุฒ `/api/db-init` ุงุณุชูุงุฏู ูฺฉูุฏ ูฺฏุฑ ุงูฺฉู ูโุฎูุงูุฏ ุชูุงู ุฏุชุงูุง ุฑุง ูพุงฺฉ ฺฉูุฏ!**

ุงู API ุชูุงู ุฌุฏุงูู ุฑุง DROP ูโฺฉูุฏ ู ุงุฒ ูู ูโุณุงุฒุฏุ ฺฉู ููุฌุฑ ุจู ุงุฒ ุฏุณุช ุฑูุชู ุชูุงู ุฏุชุงูุง ูโุดูุฏ.

## ๐ง APIูุง ูุฏุฑุช ุฏุชุงุจุณ

### 1. `/api/db-init` - ุจุงุฒุณุงุฒ ฺฉุงูู (ุฎุทุฑูุงฺฉ!)
```bash
POST /api/db-init
Body: { "adminKey": "mohamad.tir1383" }
```

**ูุดุฏุงุฑ**: ุงู API:
- ุชูุงู ุฌุฏุงูู ุฑุง ุญุฐู ูโฺฉูุฏ (DROP)
- ุชูุงู ุฏุชุงูุง ุฑุง ูพุงฺฉ ูโฺฉูุฏ
- ุฌุฏุงูู ุฑุง ุงุฒ ูู ูโุณุงุฒุฏ

**ููุท ุฏุฑ ุงู ููุงุฑุฏ ุงุณุชูุงุฏู ฺฉูุฏ**:
- ุงููู ุจุงุฑ ฺฉู ุฏุชุงุจุณ ุฑุง ุฑุงูโุงูุฏุงุฒ ูโฺฉูุฏ
- ูโุฎูุงูุฏ ุฏุชุงุจุณ ุฑุง ฺฉุงููุงู ูพุงฺฉ ฺฉูุฏ ู ุงุฒ ูู ุดุฑูุน ฺฉูุฏ
- ุฏุฑ ูุญุท ุชูุณุนู (Development)

### 2. `/api/db-add-tables` - ุงุถุงูู ฺฉุฑุฏู ุฌุฏุงูู ุฌุฏุฏ (ุงูู)
```bash
POST /api/db-add-tables
Body: { "adminKey": "mohamad.tir1383" }
```

**ุงู API ุงูู ุงุณุช**: 
- ููุท ุฌุฏุงูู ุฌุฏุฏ ุฑุง ุงุถุงูู ูโฺฉูุฏ
- ุฌุฏุงูู ููุฌูุฏ ุฑุง ุฏุณุช ููโุฒูุฏ
- ุฏุชุงูุง ูุฏู ุฑุง ุญูุธ ูโฺฉูุฏ

**ุงุณุชูุงุฏู ฺฉูุฏ ููุช**:
- ูโุฎูุงูุฏ ุฌุฏุงูู ุฌุฏุฏ (ูุซู learned_knowledge) ุงุถุงูู ฺฉูุฏ
- ุจุนุฏ ุงุฒ ุจุฑูุฒุฑุณุงู ฺฉุฏ ฺฉู ุฌุฏุงูู ุฌุฏุฏ ูุงุฒ ุฏุงุฑุฏ
- ุฏุฑ ูุญุท Production

## ๐ ูุฑุงุญู ููุงุฌุฑุช ุจุฑุง ุจุฑูุฒุฑุณุงูโูุง ุขูุฏู

### ูุฑุญูู 1: ุจุฑุฑุณ ุฌุฏุงูู ููุฌูุฏ
ูุจู ุงุฒ ูุฑ ุชุบุฑุ ูุณุช ุฌุฏุงูู ููุฌูุฏ ุฑุง ุจุฑุฑุณ ฺฉูุฏ:

```sql
SELECT table_name 
FROM information_schema.tables 
WHERE table_schema = 'public';
```

### ูุฑุญูู 2: ุงุถุงูู ฺฉุฑุฏู ุฌุฏุงูู ุฌุฏุฏ
ุงุฒ API ุงูู ุงุณุชูุงุฏู ฺฉูุฏ:

```bash
curl -X POST https://businessmeter.ir/api/db-add-tables \
  -H "Content-Type: application/json" \
  -d '{"adminKey":"mohamad.tir1383"}'
```

ุง ุจุง PowerShell:

```powershell
Invoke-RestMethod -Uri "https://businessmeter.ir/api/db-add-tables" `
  -Method Post `
  -ContentType "application/json" `
  -Body '{"adminKey":"mohamad.tir1383"}'
```

### ูุฑุญูู 3: ุชุงุฏ ููููุช
ุจุฑุฑุณ ฺฉูุฏ ฺฉู ุฌุฏุงูู ุฌุฏุฏ ุงุถุงูู ุดุฏูโุงูุฏ:

```bash
# ุจุฑุฑุณ ุขูุงุฑ
curl https://businessmeter.ir/api/admin/stats

# ุจุฑุฑุณ ุขูุงุฑ ุงุฏฺฏุฑ
curl https://businessmeter.ir/api/admin/learning-stats
```

## ๐๏ธ ุณุงุฎุชุงุฑ ูุนู ุฏุชุงุจุณ

### ุฌุฏุงูู ุงุตู
1. **users** - ุงุทูุงุนุงุช ฺฉุงุฑุจุฑุงู
2. **chats** - ูฺฉุงููุงุช
3. **messages** - ูพุงูโูุง

### ุฌุฏุงูู ุงุฏฺฏุฑ (ุฌุฏุฏ)
4. **learned_knowledge** - ุฏุงูุด ุงุฏฺฏุฑ ุดุฏู
5. **conversation_feedback** - ุจุงุฒุฎูุฑุฏ ฺฉุงุฑุจุฑุงู

## ๐ ูุฑุขูุฏ ุจุฑูุฒุฑุณุงู ุงูู

### ุจุฑุง ุจุฑูุฒุฑุณุงูโูุง ุขูุฏู:

1. **ุชูุณุนู ูุญู**:
   ```bash
   # ุฏุฑ ูุญุท local ูโุชูุงูุฏ ุงุฒ db-init ุงุณุชูุงุฏู ฺฉูุฏ
   POST http://localhost:3000/api/db-init
   ```

2. **ุชุณุช**:
   - ุชูุงู APIูุง ุฑุง ุชุณุช ฺฉูุฏ
   - ูุทูุฆู ุดูุฏ migration ุฏุฑุณุช ฺฉุงุฑ ูโฺฉูุฏ

3. **Production**:
   ```bash
   # ููุท ุงุฒ db-add-tables ุงุณุชูุงุฏู ฺฉูุฏ
   POST https://businessmeter.ir/api/db-add-tables
   ```

4. **ุชุงุฏ**:
   - ุจุฑุฑุณ ฺฉูุฏ ฺฉู ุฏุชุงูุง ูุฏู ุณุงูู ูุณุชูุฏ
   - ุจุฑุฑุณ ฺฉูุฏ ฺฉู ุฌุฏุงูู ุฌุฏุฏ ุงุถุงูู ุดุฏูโุงูุฏ

## ๐ ุจุฑุฑุณ ุณูุงูุช ุฏุชุงุจุณ

### ฺฺฉ ฺฉุฑุฏู ุชุนุฏุงุฏ ุฑฺฉูุฑุฏูุง
```bash
# ุชุนุฏุงุฏ ฺฉุงุฑุจุฑุงู
curl https://businessmeter.ir/api/admin/stats

# ุชุนุฏุงุฏ ุฏุงูุด ุงุฏฺฏุฑ ุดุฏู
curl https://businessmeter.ir/api/admin/learning-stats
```

### ฺฺฉ ฺฉุฑุฏู ุงุชุตุงู ุฏุชุงุจุณ
```bash
curl https://businessmeter.ir/api/db-test
```

## ๐จ ุจุงุฒุงุจ ุงุฒ ุฎุทุง

### ุงฺฏุฑ ุฏุชุงูุง ูพุงฺฉ ุดุฏูุฏ:

1. **ุจุฑุฑุณ Backup**:
   - ุขุง ุงุฒ ุฏุชุงุจุณ backup ุฏุงุฑุฏุ
   - ุขุง Liara backup ุฎูุฏฺฉุงุฑ ุฏุงุฑุฏุ

2. **ุจุงุฒุงุจ ุงุฒ Backup**:
   ```bash
   # ุงุฒ ูพูู Liara backup ุฑุง restore ฺฉูุฏ
   ```

3. **ุงฺฏุฑ backup ูุณุช**:
   - ูุชุงุณูุงูู ุฏุชุงูุง ุงุฒ ุฏุณุช ุฑูุชูโุงูุฏ
   - ุงุฒ ุงู ุจู ุจุนุฏ ุญุชูุงู backup ููุธู ุฏุงุดุชู ุจุงุดุฏ

## ๐ก ุชูุตูโูุง ููู

### 1. Backup ููุธู
- ูุฑ ุฑูุฒ ุงุฒ ุฏุชุงุจุณ backup ุจฺฏุฑุฏ
- Backup ุฑุง ุฏุฑ ูฺฉุงู ุงูู ูฺฏู ุฏุงุฑุฏ
- ูุจู ุงุฒ ูุฑ ุจุฑูุฒุฑุณุงู ุจุฒุฑฺฏุ backup ุจฺฏุฑุฏ

### 2. ูุญุท Test
- ฺฉ ูุญุท test ุฌุฏุงฺฏุงูู ุฏุงุดุชู ุจุงุดุฏ
- ุชูุงู ุชุบุฑุงุช ุฑุง ุงูู ุฏุฑ test ุงูุชุญุงู ฺฉูุฏ
- ุจุนุฏ ุจู production ููุชูู ฺฉูุฏ

### 3. Migration Scripts
- ุจุฑุง ุชุบุฑุงุช ูพฺุฏูุ migration script ุจููุณุฏ
- Migration ุฑุง version control ฺฉูุฏ
- ูุณุชูุฏุงุช ฺฉุงูู ุฏุงุดุชู ุจุงุดุฏ

### 4. Monitoring
- ูุงฺฏโูุง ุฏุชุงุจุณ ุฑุง ุจุฑุฑุณ ฺฉูุฏ
- ุงุฒ ุงุจุฒุงุฑูุง monitoring ุงุณุชูุงุฏู ฺฉูุฏ
- Alert ุจุฑุง ูุดฺฉูุงุช ุชูุธู ฺฉูุฏ

## ๐ ฺฺฉโูุณุช ูุจู ุงุฒ ุจุฑูุฒุฑุณุงู

- [ ] Backup ุงุฒ ุฏุชุงุจุณ ฺฏุฑูุชู ุดุฏู
- [ ] ุชุบุฑุงุช ุฏุฑ ูุญุท test ุงูุชุญุงู ุดุฏู
- [ ] Migration script ุขูุงุฏู ุงุณุช
- [ ] ุชู ุงุฒ ุจุฑูุฒุฑุณุงู ูุทูุน ุงุณุช
- [ ] ุฒูุงู ููุงุณุจ ุงูุชุฎุงุจ ุดุฏู (ุชุฑุงูฺฉ ฺฉู)
- [ ] Plan ุจุงุฒฺฏุดุช (Rollback) ุขูุงุฏู ุงุณุช

## ๐ ููฺฉโูุง ููุฏ

- [ูุณุชูุฏุงุช Drizzle ORM](https://orm.drizzle.team/)
- [ูุณุชูุฏุงุช PostgreSQL](https://www.postgresql.org/docs/)
- [ุฑุงูููุง Liara Database](https://docs.liara.ir/databases/postgresql/)

## ๐ ูพุดุชุจุงู

ุฏุฑ ุตูุฑุช ุจุฑูุฒ ูุดฺฉู:
1. ูุงฺฏโูุง ุณุฑูุฑ ุฑุง ุจุฑุฑุณ ฺฉูุฏ
2. ูุถุนุช ุฏุชุงุจุณ ุฑุง ฺฺฉ ฺฉูุฏ
3. ุจุง ุชู ุชูุณุนู ุชูุงุณ ุจฺฏุฑุฏ

---

**ุงุฏุขูุฑ**: ููุดู ูุจู ุงุฒ ูุฑ ุชุบุฑ ูููุ ุงุฒ ุฏุชุงุจุณ backup ุจฺฏุฑุฏ!
